/**
 * AngularJS <-> Collection+JSON middleware
 * @author ievans3024
 * @preserve true
 */
function Collection(collection){var i,collection_props;if(!(this instanceof Collection)){return new Collection(collection)}this.collection={};if(typeof collection==="string"){collection=JSON.parse(collection)}if(collection.hasOwnProperty("collection")){collection=collection.collection}collection=Collection.prototype.parse(collection);collection_props=Object.getOwnPropertyNames(collection);for(i=0;i<collection_props.length;i++){this[collection_props[i]]=collection[collection_props[i]]}}Collection.prototype.property_rules={error:{construct:CollectionError},href:{type:"string",required:true},items:{construct:Array,contents:{construct:CollectionItem}},links:{construct:Array,contents:{construct:CollectionLink}},queries:{construct:Array,contents:{construct:CollectionQuery}},template:{construct:CollectionTemplate},version:{type:"string",required:true}};Collection.prototype.toString=function(){var i,acceptable_instance=false;for(i=0;i<Collection.hooked.length;i++){if(this instanceof Collection.hooked[i]){acceptable_instance=true;break}}if(acceptable_instance){return JSON.stringify({collection:this},this.preJSON)}};Collection.prototype.parse=function(object){var i,i_2,prop,property,r,rule,rule_object,rules,collection=object;function process_array(array,contains){var i,output=[];if(!(array instanceof Array)){throw new TypeError("array parameter must be an Array.")}if(typeof contains!=="function"){throw new TypeError("contains parameter must be a function.")}for(i=0;i<array.length;i++){if(array[i]instanceof contains){output.push(array[i])}else{output.push(new contains(array[i]))}}if(output.length>0){return output}}if(typeof object==="string"){object=JSON.parse(object)}rules=Object.getOwnPropertyNames(this.property_rules);for(i=0;i<rules.length;i++){prop=rules[i];if(object.hasOwnProperty(prop)){property=object[prop];rule_object=this.property_rules[prop];rule=Object.getOwnPropertyNames(rule_object);for(i_2=0;i_2<rule.length;i_2++){r=rule[i_2];if(r==="required"&&rule_object.required){if(!object.hasOwnProperty(prop)){throw new Error(prop+" is a required property.")}}if(r==="construct"){if(rule_object.construct===Array){property=process_array(property,rule_object.contents.construct)}else{if(!(property instanceof rule_object.construct)){property=new rule_object.construct(property)}}}if(r==="type"){if(typeof property!==rule_object.type){throw new TypeError(prop+" must be of type "+rule_object.type)}}}collection[prop]=property}}return collection};Collection.hook=function(construct){Collection.hooked.push(construct);construct.prototype.toString=Collection.prototype.toString;construct.prototype.parse=Collection.prototype.parse};Collection.hooked=[Collection];function CollectionData(fields){var i,opts;if(!(this instanceof CollectionData)){return new CollectionData(fields)}this.array=fields;for(i=0;i<this.array.length;i++){opts=CollectionData.prototype.parse(fields[i]);this[opts.name]=this.array[i]}}CollectionData.prototype.property_rules={name:{type:"string",required:true},prompt:{type:"string"}};CollectionData.prototype.toArray=function(){if(this instanceof CollectionData){return this.array}};CollectionData.prototype.preJSON=CollectionData.prototype.toArray;Collection.hook(CollectionData);function CollectionError(opts){var i,opts_props;if(!(this instanceof CollectionError)){return new CollectionError(opts)}opts=CollectionError.prototype.parse(opts);opts_props=Object.getOwnPropertyNames(opts);for(i=0;i<opts_props.length;i++){this[opts_props[i]]=opts[opts_props[i]]}}CollectionError.prototype.property_rules={title:{type:"string"},code:{type:"string"},message:{type:"string"}};Collection.hook(CollectionError);function CollectionItem(opts){var i,opts_props;if(!(this instanceof CollectionItem)){return new CollectionItem(opts)}opts=CollectionItem.prototype.parse(opts);opts_props=Object.getOwnPropertyNames(opts);for(i=0;i<opts_props.length;i++){this[opts_props[i]]=opts[opts_props[i]]}}CollectionItem.prototype.property_rules={href:Collection.prototype.property_rules.href,data:{construct:CollectionData},links:Collection.prototype.property_rules.links};Collection.hook(CollectionItem);function CollectionLink(opts){var i,opts_props;if(!(this instanceof CollectionLink)){return new CollectionLink(opts)}opts=CollectionLink.prototype.parse(opts);opts_props=Object.getOwnPropertyNames(opts);for(i=0;i<opts_props.length;i++){this[opts_props[i]]=opts[opts_props[i]]}}CollectionLink.prototype.property_rules={href:Collection.prototype.property_rules.href,rel:{type:"string",required:true},prompt:{type:"string"},name:{type:"string"},render:{type:"string"}};Collection.hook(CollectionLink);function CollectionQuery(opts){var i,opts_props;if(!(this instanceof CollectionQuery)){return new CollectionQuery(opts)}opts=CollectionQuery.prototype.parse(opts);opts_props=Object.getOwnPropertyNames(opts);for(i=0;i<opts_props.length;i++){this[opts_props[i]]=opts[opts_props[i]]}}CollectionQuery.prototype.property_rules=CollectionLink.prototype.property_rules;delete CollectionQuery.prototype.property_rules.render;CollectionQuery.prototype.property_rules.data=CollectionItem.prototype.property_rules.data;Collection.hook(CollectionQuery);function CollectionTemplate(opts){var i,opts_props;if(!(this instanceof CollectionTemplate)){return new CollectionTemplate(opts)}opts=CollectionTemplate.prototype.parse(opts);opts_props=Object.getOwnPropertyNames(opts);for(i=0;i<opts_props.length;i++){this[opts_props[i]]=opts[opts_props[i]]}}CollectionTemplate.prototype.property_rules={data:CollectionItem.prototype.property_rules.data};Collection.hook(CollectionTemplate);